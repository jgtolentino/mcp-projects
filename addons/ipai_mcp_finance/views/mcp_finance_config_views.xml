<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- MCP Finance Config Form View -->
    <record id="mcp_finance_config_form" model="ir.ui.view">
        <field name="name">mcp.finance.config.form</field>
        <field name="model">mcp.finance.config</field>
        <field name="arch" type="xml">
            <form string="MCP Finance Configuration">
                <sheet>
                    <group>
                        <group string="Company">
                            <field name="company_id" readonly="1"/>
                            <field name="currency_id" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Tool Enablement" name="tools">
                            <group>
                                <group string="Query Tools (Read-Only)">
                                    <field name="enable_trial_balance"/>
                                    <field name="enable_aging_report"/>
                                </group>
                                <group string="Write Tools (Require Caution)">
                                    <field name="enable_journal_entry"/>
                                    <field name="enable_month_end"/>
                                </group>
                            </group>
                            <group>
                                <group string="Compliance Tools">
                                    <field name="enable_bir_tools"/>
                                </group>
                            </group>
                        </page>
                        <page string="Safety Controls" name="safety">
                            <group>
                                <group string="Journal Entry Controls">
                                    <field name="require_approval_je"/>
                                    <field name="max_je_amount" 
                                           attrs="{'invisible': [('require_approval_je', '=', False)]}"/>
                                </group>
                                <group string="Audit">
                                    <field name="log_all_queries"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- MCP Finance Config Tree View -->
    <record id="mcp_finance_config_tree" model="ir.ui.view">
        <field name="name">mcp.finance.config.tree</field>
        <field name="model">mcp.finance.config</field>
        <field name="arch" type="xml">
            <tree string="MCP Finance Configurations">
                <field name="company_id"/>
                <field name="enable_trial_balance"/>
                <field name="enable_journal_entry"/>
                <field name="enable_bir_tools"/>
                <field name="require_approval_je"/>
            </tree>
        </field>
    </record>

    <!-- MCP Finance Tool Tree View -->
    <record id="mcp_finance_tool_tree" model="ir.ui.view">
        <field name="name">mcp.finance.tool.tree</field>
        <field name="model">mcp.finance.tool</field>
        <field name="arch" type="xml">
            <tree string="MCP Finance Tools">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="technical_name"/>
                <field name="category"/>
                <field name="requires_approval"/>
                <field name="active"/>
            </tree>
        </field>
    </record>

    <!-- MCP Finance Tool Form View -->
    <record id="mcp_finance_tool_form" model="ir.ui.view">
        <field name="name">mcp.finance.tool.form</field>
        <field name="model">mcp.finance.tool</field>
        <field name="arch" type="xml">
            <form string="MCP Finance Tool">
                <sheet>
                    <div class="oe_title">
                        <h1><field name="name" placeholder="Tool Name"/></h1>
                    </div>
                    <group>
                        <group>
                            <field name="technical_name"/>
                            <field name="category"/>
                            <field name="sequence"/>
                        </group>
                        <group>
                            <field name="requires_approval"/>
                            <field name="active"/>
                        </group>
                    </group>
                    <group string="Description">
                        <field name="description" nolabel="1"/>
                    </group>
                    <group string="Parameter Schema (JSON)">
                        <field name="parameter_schema" nolabel="1" widget="ace" 
                               options="{'mode': 'json'}"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- MCP Finance Execution Tree View -->
    <record id="mcp_finance_execution_tree" model="ir.ui.view">
        <field name="name">mcp.finance.tool.execution.tree</field>
        <field name="model">mcp.finance.tool.execution</field>
        <field name="arch" type="xml">
            <tree string="MCP Finance Executions" default_order="create_date desc"
                  decoration-danger="state == 'failed'"
                  decoration-warning="state == 'pending'"
                  decoration-success="state == 'executed'">
                <field name="create_date"/>
                <field name="tool_id"/>
                <field name="user_id"/>
                <field name="company_id"/>
                <field name="state"/>
                <field name="execution_time_ms"/>
                <field name="error_message" optional="hide"/>
            </tree>
        </field>
    </record>

    <!-- MCP Finance Execution Form View -->
    <record id="mcp_finance_execution_form" model="ir.ui.view">
        <field name="name">mcp.finance.tool.execution.form</field>
        <field name="model">mcp.finance.tool.execution</field>
        <field name="arch" type="xml">
            <form string="MCP Finance Execution" create="0" edit="0">
                <header>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="tool_id"/>
                            <field name="user_id"/>
                            <field name="company_id"/>
                            <field name="create_date"/>
                        </group>
                        <group>
                            <field name="execution_time_ms"/>
                            <field name="error_message" 
                                   attrs="{'invisible': [('state', '!=', 'failed')]}"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Parameters">
                            <field name="parameters" widget="ace" options="{'mode': 'json'}"/>
                        </page>
                        <page string="Result">
                            <field name="result" widget="ace" options="{'mode': 'json'}"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Actions -->
    <record id="action_mcp_finance_config" model="ir.actions.act_window">
        <field name="name">MCP Finance Configuration</field>
        <field name="res_model">mcp.finance.config</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="action_mcp_finance_tool" model="ir.actions.act_window">
        <field name="name">MCP Finance Tools</field>
        <field name="res_model">mcp.finance.tool</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="action_mcp_finance_execution" model="ir.actions.act_window">
        <field name="name">MCP Finance Audit Log</field>
        <field name="res_model">mcp.finance.tool.execution</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_today': 1}</field>
    </record>

    <!-- Menus -->
    <menuitem id="menu_mcp_finance_root"
              name="MCP Finance"
              parent="account.menu_finance_configuration"
              sequence="99"/>

    <menuitem id="menu_mcp_finance_config"
              name="Configuration"
              parent="menu_mcp_finance_root"
              action="action_mcp_finance_config"
              sequence="10"/>

    <menuitem id="menu_mcp_finance_tools"
              name="Tools"
              parent="menu_mcp_finance_root"
              action="action_mcp_finance_tool"
              sequence="20"/>

    <menuitem id="menu_mcp_finance_audit"
              name="Audit Log"
              parent="menu_mcp_finance_root"
              action="action_mcp_finance_execution"
              sequence="30"/>
</odoo>
